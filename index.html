<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>MQTT & «Parser Combinators»</title>

    <meta name="description" content="Les bases de SSL et TLS">
    <meta name="author" content="Frédéric Cabestre">

    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/solarized.css" id="theme">
    <link rel="stylesheet" href="myAssets/css/transparents.css">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
</head>

<body>

<div class="reveal">

    <div class="slides">
        <section>
            <h1><span class="orange">MQTT</span></p><span class="green">&</span></span></p><span class="blue">Parser Combinators</span></h1>
        </section>

        <section>
            <h2>
                Qui suis-je ?
            </h2>
            <ul>
                <span class="fragment">
                    <li>Un développeur</li>
                    <li>(Mise en œuvre des) langages</li>
                    <li style="margin-bottom:32px">Systèmes (distribués)</li>
                </span>

                <span class="fragment">
                    <li>Telelogic - atelier de génie logiciel</li>
                    <li> - Plateforme de «Grid computing»</li>
                    <li style="margin-bottom:32px">OVH - PaaS IoT</li>
                </span>

                <span class="fragment">
                    <li><img src="myAssets/images/github.svg" style="background-color:#181717; margin-bottom:0; margin-top:0; height:32px"> @fcabestre</li>
                    <li><img src="myAssets/images/twitter.svg" style="background-color:#55ACEE; margin-bottom:0; margin-top:0; height:32px"> https://github.com/fcabestre</li>
                </span>
            </ul>
        </section>

        <section>
            <img src="myAssets/images/xavier2.jpeg"/>
        </section>

        <section>
            <img src="myAssets/images/ritchie&thompson2.jpeg"/>
        </section>


        <section>
            <h2>
                Au menu aujourd'hui
            </h2>
            <ul>
                <span class="fragment">
                    <li>Une librairie MQTT open-source</li>
                </span>

                <span class="fragment">
                    <li>Des «parser combinators»</li>
                </span>

                <span class="fragment">
                    <li>Scodec</li>
                </span>

                <span class="fragment">
                    <li>Rust</li>
                </span>
            </ul>
        </section>

        <section>
            <img src="myAssets/images/SMQTTL.png"/>
        </section>

        <section>
            <h2>
                Et donc... MQTT
            </h2>
            <ul>
                <span class="fragment"><li><span class="blue">M</span>essage <span class="blue">Q</span>ueuing <span class="blue">T</span>elemetry <span class="blue">T</span>ransport</li></span>
                <span class="fragment"><li>Publish/Subscribe</li></span>
                <span class="fragment"><li>TCP</li></span>
                <span class="fragment"><li>Initialement IBM</li></span>
                <span class="fragment"><li>Actuellement OASIS</li></span>
                <span class="fragment"><li>Dernière version 3.1.1</li></span>
            </ul>

        </section>

        <section>
            <img src="myAssets/images/2782960.jpg"/>
        </section>

        <section>
            <blockquote class="twitter-tweet" data-conversation="none" lang="fr"><p lang="en" dir="ltr"><a href="https://twitter.com/hseeberger">@hseeberger</a> MQTT, has it been fixed?</p>&mdash; The Klang (@viktorklang) <a href="https://twitter.com/viktorklang/status/652430395355594752">9 Octobre 2015</a></blockquote>
        </section>

        <section>
            <img src="myAssets/images/klang2.png"/>
        </section>

        <section>
            <img src="myAssets/images/Vasters.png"/>
        </section>

        <section>
            <img src="myAssets/images/hisgherOrderFunctions.jpg"/>
        </section>

        <section>
            <pre><code class="scala" data-trim style="font-size: 16px;">
object ConnectFrame {

    implicit val discriminator: Discriminator[Frame, ConnectFrame, Int] =
                Discriminator(1)

    implicit val codec: Codec[ConnectFrame] =

       (headerCodec :: variableSizeBytes(remainingLengthCodec,
        connectVariableHeaderCodec >>:~ { (hdr: ConnectVariableHeader) ⇒
        stringCodec ::
        conditional(hdr.willFlag, stringCodec) ::
        conditional(hdr.willFlag, stringCodec) ::
        conditional(hdr.userNameFlag, stringCodec) ::
        conditional(hdr.passwordFlag, stringCodec)

    })).as[ConnectFrame]
}
            </code></pre>
        </section>

        <section>
            <pre><code class="scala" data-trim style="font-size: 16px;">
val codec: Codec[PubackFrame] = (
        headerCodec :: variableSizeBytes(
                remainingLengthCodec, messageIdCodec
        )
).as[PubackFrame]
            </code></pre>
        </section>

        <section>
            <pre><code class="scala" data-trim style="font-size: 16px;">
final class RemainingLengthCodec extends Codec[Int] {

    val MinValue = 0
    val MaxValue = 268435455

    def sizeBound = SizeBound.bounded(8, 32)

    def decode(bits: BitVector): Attempt[DecodeResult[Int]] = {
        @annotation.tailrec
        def decodeAux(step: Attempt[DecodeResult[Int]], factor: Int, depth: Int, value: Int): Attempt[DecodeResult[Int]] =
            if (depth == 4) failure(Err("The remaining length must be 4 bytes long at most"))
            else step match {
                case f: Failure ⇒ f
                case Successful(d) ⇒
                if ((d.value & 128) == 0) successful(DecodeResult(value + (d.value & 127) * factor, d.remainder))
                else decodeAux(uint8.decode(d.remainder), factor * 128, depth + 1, value + (d.value & 127) * factor)
            }
        decodeAux(uint8.decode(bits), 1, 0, 0)
    }

    def encode(value: Int): Attempt[BitVector] = {
        @annotation.tailrec
        def encodeAux(value: Int, digit: Int, bytes: ByteVector): ByteVector =
            if (value == 0) bytes :+ digit.asInstanceOf[Byte]
            else encodeAux(value / 128, value % 128, bytes :+ (digit | 0x80).asInstanceOf[Byte])
            if (value < MinValue || value > MaxValue) failure(Err(s"The remaining length must be in the range [$MinValue..$MaxValue], $value is not valid"))
            else successful(BitVector(encodeAux(value / 128, value % 128, ByteVector.empty)))
    }
}
            </code></pre>
        </section>

        <section>
            <img class="cachet" src="myAssets/images/cachets.png"/>
        </section>

        <section>
            <img src="myAssets/images/Nom.png"/>
        </section>

        <section>
            <img src="myAssets/images/combine.jpg"/>
        </section>

    </div>

</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>

    // Full list of configuration options available at:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: false,
        progress: false,
        history: true,
        center: true,

        transition: 'none', // none/fade/slide/convex/concave/zoom

        math: {
            mathjax: 'https://cdn.mathjax.org/mathjax/latest/MathJax.js',
            config: 'TeX-AMS_HTML-full'  // See http://docs.mathjax.org/en/latest/config-files.html
        },

        // Optional reveal.js plugins
        dependencies: [
            { src: 'plugin/math/math.js', async: true },
            {
                src: 'lib/js/classList.js', condition: function () {
                return !document.body.classList;
            }
            },
            {
                src: 'plugin/markdown/marked.js', condition: function () {
                return !!document.querySelector('[data-markdown]');
            }
            },
            {
                src: 'plugin/markdown/markdown.js', condition: function () {
                return !!document.querySelector('[data-markdown]');
            }
            },
            {
                src: 'plugin/highlight/highlight.js', async: true, condition: function () {
                return !!document.querySelector('pre code');
            }, callback: function () {
                hljs.initHighlightingOnLoad();
            }
            },
            {src: 'plugin/zoom-js/zoom.js', async: true},
            {src: 'plugin/notes/notes.js', async: true}
        ]
    });

</script>

</body>
</html>
